/**
 * Module      : CRC8.mo
 * Description : 8-bit cyclic redundancy check.
 * Copyright   : 2020 Enzo Haussecker
 * License     : Apache 2.0 with LLVM Exception
 * Maintainer  : Enzo Haussecker <enzo@dfinity.org>
 * Stability   : Stable
 */

import Prim "mo:prim";

module {

  private let table : [Word8] = [
    000, 007, 014, 009, 028, 027, 018, 021,
    056, 063, 054, 049, 036, 035, 042, 045,
    112, 119, 126, 121, 108, 107, 098, 101,
    072, 079, 070, 065, 084, 083, 090, 093,
    224, 231, 238, 233, 252, 251, 242, 245,
    216, 223, 214, 209, 196, 195, 202, 205,
    144, 151, 158, 153, 140, 139, 130, 133,
    168, 175, 166, 161, 180, 179, 186, 189,
    199, 192, 201, 206, 219, 220, 213, 210,
    255, 248, 241, 246, 227, 228, 237, 234,
    183, 176, 185, 190, 171, 172, 165, 162,
    143, 136, 129, 134, 147, 148, 157, 154,
    039, 032, 041, 046, 059, 060, 053, 050,
    031, 024, 017, 022, 003, 004, 013, 010,
    087, 080, 089, 094, 075, 076, 069, 066,
    111, 104, 097, 102, 115, 116, 125, 122,
    137, 142, 135, 128, 149, 146, 155, 156,
    177, 182, 191, 184, 173, 170, 163, 164,
    249, 254, 247, 240, 229, 226, 235, 236,
    193, 198, 207, 200, 221, 218, 211, 212,
    105, 110, 103, 096, 117, 114, 123, 124,
    081, 086, 095, 088, 077, 074, 067, 068,
    025, 030, 023, 016, 005, 002, 011, 012,
    033, 038, 047, 040, 061, 058, 051, 052,
    078, 073, 064, 071, 082, 085, 092, 091,
    118, 113, 120, 127, 106, 109, 100, 099,
    062, 057, 048, 055, 034, 037, 044, 043,
    006, 001, 008, 015, 026, 029, 020, 019,
    174, 169, 160, 167, 178, 181, 188, 187,
    150, 145, 152, 159, 138, 141, 132, 131,
    222, 217, 208, 215, 194, 197, 204, 203,
    230, 225, 232, 239, 250, 253, 244, 243,
  ];

  public func crc8(data : [Word8]) : Word8 {
    var result : Word8 = 0;
    for (byte in data.vals()) {
      result := table[Prim.word8ToNat(result ^ byte)];
    };
    return result;
  };
};
